// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ì‚¬ìš©ì ë° ê¶Œí•œ
enum UserRole {
  RESEARCHER // ì—°êµ¬ì
  BUYER // êµ¬ë§¤ ë‹´ë‹¹ì
  SUPPLIER // ê³µê¸‰ì‚¬
  ADMIN // ê´€ë¦¬ì
}

// ì¡°ì§ ë‚´ ì—­í•  (ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì—­í• )
enum OrganizationRole {
  VIEWER // ì¡°íšŒë§Œ ê°€ëŠ¥
  REQUESTER // ê²¬ì  ìš”ì²­ ê°€ëŠ¥
  APPROVER // ê²¬ì  ìŠ¹ì¸ ê°€ëŠ¥
  ADMIN // ì¡°ì§ ê´€ë¦¬ì
}

// êµ¬ë… í”Œëœ íƒ€ì…
enum SubscriptionPlan {
  FREE // ë¬´ë£Œ/Beta
  TEAM // íŒ€ í”Œëœ
  ORGANIZATION // ì¡°ì§/Enterprise í”Œëœ
}

// ì¡°ì§/ì›Œí¬ìŠ¤í˜ì´ìŠ¤
model Organization {
  id                String           @id @default(cuid())
  name              String
  description       String?          @db.Text
  plan              SubscriptionPlan @default(FREE) // êµ¬ë… í”Œëœ
  planExpiresAt     DateTime? // í”Œëœ ë§Œë£Œì¼
  maxMembers        Int? // ìµœëŒ€ ë©¤ë²„ ìˆ˜ (í”Œëœë³„ ì œí•œ)
  maxQuotesPerMonth Int? // ì›”ë³„ ìµœëŒ€ í’ˆëª© ë¦¬ìŠ¤íŠ¸ ìˆ˜
  maxSharedLinks    Int? // ìµœëŒ€ ê³µìœ  ë§í¬ ìˆ˜
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  // ê´€ê³„
  members         OrganizationMember[]
  quotes          Quote[]
  templates       QuoteTemplate[]
  inventories     ProductInventory[]
  purchaseRecords PurchaseRecord[]
  budgets         Budget[]
  subscription    Subscription? // êµ¬ë… ì •ë³´

  @@index([name])
  @@index([plan])
}

// ì¡°ì§ ë©¤ë²„
model OrganizationMember {
  id             String           @id @default(cuid())
  userId         String
  organizationId String
  role           OrganizationRole @default(VIEWER)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  // ê´€ê³„
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([userId, organizationId])
  @@index([userId])
  @@index([organizationId])
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  emailVerified DateTime?
  name          String?
  image         String?
  role          UserRole  @default(RESEARCHER)
  organization  String? // ë ˆê±°ì‹œ í•„ë“œ (ì¡°ì§ëª… ì§ì ‘ ì…ë ¥)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // NextAuth ê´€ê³„
  accounts Account[]
  sessions Session[]

  // ê´€ê³„
  quotes              Quote[]
  comparisons         Comparison[]
  favorites           Favorite[]
  searchHistory       SearchHistory[]
  organizationMembers OrganizationMember[]
  reviews             Review[]
  templates           QuoteTemplate[]
  inventories         ProductInventory[]
  inventoryUsage      InventoryUsage[]

  @@index([email])
  @@index([role])
}

// NextAuth.js v5ë¥¼ ìœ„í•œ ëª¨ë¸
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

// ì œí’ˆ ì¹´í…Œê³ ë¦¬
enum ProductCategory {
  REAGENT // ì‹œì•½
  TOOL // ê¸°êµ¬
  EQUIPMENT // ì¥ë¹„
}

// ì œí’ˆ
model Product {
  id                    String                       @id @default(cuid())
  name                  String
  nameEn                String? // ì˜ë¬¸ëª…
  description           String?                      @db.Text
  descriptionEn         String?                      @db.Text
  descriptionTranslated String?                      @db.Text // ë²ˆì—­ëœ ì„¤ëª… (GPT ë²ˆì—­)
  category              ProductCategory
  brand                 String?
  modelNumber           String?
  catalogNumber         String? // ì¹´íƒˆë¡œê·¸ ë²ˆí˜¸
  specifications        Json? // ìŠ¤í™ ì •ë³´ (JSON)
  datasheetUrl          String?
  imageUrl              String?
  embedding             Unsupported("vector(1536)")? // ë²¡í„° ì„ë² ë”© (pgvector)
  // ê·¸ë£¹ì›¨ì–´ ì¹œí™”ì  í•„ë“œ
  grade                 String? // Grade (HPLC grade, GMP, EP/USP, cell culture tested ë“±)
  specification         String? // ê·œê²©/ìš©ëŸ‰ (ì˜ˆ: 1mg, 500mL, 0.22um ë“±)
  regulatoryCompliance  String? // ê·œì œ/ì•½ì „ ê·œê²© (USP, EP, JP ë“±)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ê´€ê³„
  vendors         ProductVendor[]
  comparisons     ComparisonProduct[]
  favorites       Favorite[]
  recommendations ProductRecommendation[] @relation("ProductRecommendations")
  recommendedFor  ProductRecommendation[] @relation("RecommendedProducts")
  searchHistory   SearchHistory[]
  reviews         Review[]
  quoteListItems  QuoteListItem[]
  inventories     ProductInventory[]
  purchaseRecords PurchaseRecord[]

  @@index([category])
  @@index([brand])
  @@index([name])
}

// ë²¤ë”/ê³µê¸‰ì‚¬
model Vendor {
  id                String    @id @default(cuid())
  name              String
  nameEn            String?
  email             String?
  phone             String?
  website           String?
  country           String?   @default("KR")
  currency          String?   @default("KRW")
  // ìˆ˜ìµ ëª¨ë¸ ê´€ë ¨ í•„ë“œ
  isPremium         Boolean   @default(false) // í”„ë¦¬ë¯¸ì—„ í”Œëœ ì—¬ë¶€
  premiumExpiresAt  DateTime? // í”„ë¦¬ë¯¸ì—„ ë§Œë£Œì¼
  leadPricePerQuote Float?    @default(0) // ë¦¬ë“œë‹¹ ê³¼ê¸ˆ (ê²¬ì  ìš”ì²­ë‹¹)
  totalLeads        Int       @default(0) // ì´ ë¦¬ë“œ ìˆ˜
  totalRevenue      Float     @default(0) // ì´ ìˆ˜ìµ
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // ê´€ê³„
  products        ProductVendor[]
  quoteResponses  QuoteResponse[]
  billingRecords  VendorBillingRecord[]
  purchaseRecords PurchaseRecord[]

  @@index([name])
  @@index([isPremium])
}

// ì œí’ˆ-ë²¤ë” ê´€ê³„ (ê°€ê²©, ì¬ê³ , ë‚©ê¸° ì •ë³´)
model ProductVendor {
  id                String   @id @default(cuid())
  productId         String
  vendorId          String
  price             Float?
  currency          String   @default("KRW")
  priceInKRW        Float? // KRW í™˜ì‚° ê°€ê²©
  stockStatus       String? // ì¬ê³  ìƒíƒœ
  leadTime          Int? // ë‚©ê¸°ì¼ (ì¼ ë‹¨ìœ„)
  minOrderQty       Int?
  url               String?
  // í”„ë¦¬ë¯¸ì—„ ë…¸ì¶œ ê´€ë ¨
  isPremiumFeatured Boolean  @default(false) // í”„ë¦¬ë¯¸ì—„ ì¶”ì²œ ì˜ì—­ ë…¸ì¶œ
  premiumPriority   Int      @default(0) // í”„ë¦¬ë¯¸ì—„ ìš°ì„ ìˆœìœ„ (ë†’ì„ìˆ˜ë¡ ìƒë‹¨ ë…¸ì¶œ)
  lastUpdated       DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // ê´€ê³„
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  vendor  Vendor  @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@unique([productId, vendorId])
  @@index([productId])
  @@index([vendorId])
  @@index([priceInKRW])
  @@index([isPremiumFeatured, premiumPriority])
}

// ë¹„êµ í…Œì´ë¸”
model Comparison {
  id        String   @id @default(cuid())
  userId    String
  name      String? // ë¹„êµ ì„¸íŠ¸ ì´ë¦„
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ê´€ê³„
  user     User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  products ComparisonProduct[]

  @@index([userId])
}

// ë¹„êµ-ì œí’ˆ ê´€ê³„
model ComparisonProduct {
  id           String   @id @default(cuid())
  comparisonId String
  productId    String
  order        Int // ì •ë ¬ ìˆœì„œ
  createdAt    DateTime @default(now())

  // ê´€ê³„
  comparison Comparison @relation(fields: [comparisonId], references: [id], onDelete: Cascade)
  product    Product    @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([comparisonId, productId])
  @@index([comparisonId])
}

// ê·¸ë£¹ì›¨ì–´ìš© í’ˆëª© ë¦¬ìŠ¤íŠ¸ (ê¸°ì¡´ Quote ëª¨ë¸ ìœ ì§€í•˜ë˜, ê°œë…ì„ í’ˆëª© ë¦¬ìŠ¤íŠ¸ë¡œ í™•ì¥)
model Quote {
  id             String    @id @default(cuid())
  userId         String
  organizationId String? // ì¡°ì§ ë‹¨ìœ„ ë¦¬ìŠ¤íŠ¸ì¸ ê²½ìš°
  comparisonId   String? // ë¹„êµ ì„¸íŠ¸ ê¸°ë°˜ ë¦¬ìŠ¤íŠ¸ì¸ ê²½ìš°
  title          String // ë¦¬ìŠ¤íŠ¸ ì œëª©
  description    String?   @db.Text // ë¦¬ìŠ¤íŠ¸ ì„¤ëª…/ë¹„ê³ 
  // ê·¸ë£¹ì›¨ì–´ ì—°ë™ ì •ë³´
  templateId     String? // ì‚¬ìš©í•œ í…œí”Œë¦¿ ID
  templateType   String? // í…œí”Œë¦¿ íƒ€ì… (R&D, QC, ìƒì‚° ë“±) - í•˜ìœ„ í˜¸í™˜ì„±
  exportedAt     DateTime? // ë‚´ë³´ë‚´ê¸° ì‹œì 
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // ê´€ê³„
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization    Organization?    @relation(fields: [organizationId], references: [id], onDelete: SetNull)
  template        QuoteTemplate?   @relation(fields: [templateId], references: [id], onDelete: SetNull)
  items           QuoteListItem[] // QuoteItem ëŒ€ì‹  QuoteListItem ì‚¬ìš©
  quoteItems      QuoteItem[] // ë ˆê±°ì‹œ í˜¸í™˜ì„±
  // ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•´ QuoteResponse ìœ ì§€ (í–¥í›„ ì œê±° ê°€ëŠ¥)
  responses       QuoteResponse[]
  sharedLists     SharedList[] // ê³µìœ  ë§í¬
  purchaseRecords PurchaseRecord[] // ì‹¤ì œ êµ¬ë§¤ë‚´ì—­

  @@index([userId])
  @@index([organizationId])
  @@index([templateId])
}

// í’ˆëª© ë¦¬ìŠ¤íŠ¸ í…œí”Œë¦¿ (ì¡°ì§ë³„/ìš©ë„ë³„ ì»¬ëŸ¼ ì„¸íŠ¸)
model QuoteTemplate {
  id             String   @id @default(cuid())
  name           String // í…œí”Œë¦¿ ì´ë¦„ (ì˜ˆ: "R&D ê¸°ë³¸í˜•", "QC ì‹œí—˜ìš©", "ìƒì‚° ëŒ€ëŸ‰êµ¬ë§¤í˜•")
  type           String // í…œí”Œë¦¿ íƒ€ì… (R&D, QC, PRODUCTION, CUSTOM)
  organizationId String? // ì¡°ì§ë³„ í…œí”Œë¦¿ì¸ ê²½ìš°
  userId         String? // ì‚¬ìš©ìë³„ ì»¤ìŠ¤í…€ í…œí”Œë¦¿ì¸ ê²½ìš°
  description    String?  @db.Text
  // ì»¬ëŸ¼ ì„¤ì • (JSON)
  columns        Json // í‘œì‹œí•  ì»¬ëŸ¼ê³¼ ìˆœì„œ, í•„ìˆ˜/ì„ íƒ ì—¬ë¶€ ë“±
  // ì˜ˆ: { columns: [{ key: "lineNumber", label: "Line No.", required: true, order: 1 }, ...] }
  isDefault      Boolean  @default(false) // ê¸°ë³¸ í…œí”Œë¦¿ ì—¬ë¶€
  isPublic       Boolean  @default(false) // ê³µê°œ í…œí”Œë¦¿ ì—¬ë¶€ (ë‹¤ë¥¸ ì‚¬ìš©ìë„ ì‚¬ìš© ê°€ëŠ¥)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // ê´€ê³„
  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user         User?         @relation(fields: [userId], references: [id], onDelete: Cascade)
  quotes       Quote[]

  @@index([organizationId])
  @@index([userId])
  @@index([type])
}

// ê·¸ë£¹ì›¨ì–´ìš© í’ˆëª© ë¦¬ìŠ¤íŠ¸ í•­ëª© (ê¸°ì¡´ QuoteItemì„ í™•ì¥)
model QuoteListItem {
  id         String   @id @default(cuid())
  quoteId    String
  productId  String
  lineNumber Int // Line No. (ê·¸ë£¹ì›¨ì–´ìš©)
  quantity   Int      @default(1)
  unitPrice  Float? // ë‹¨ê°€
  currency   String?  @default("KRW")
  lineTotal  Float? // ê¸ˆì•¡ (ë‹¨ê°€ Ã— ìˆ˜ëŸ‰)
  notes      String?  @db.Text // ë¹„ê³  (ìš©ë„/ëŒ€ì²´í’ˆ ì—¬ë¶€/ê¸°ì¡´ ì œí’ˆ ì½”ë“œ ë“±)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // ê´€ê³„
  quote   Quote   @relation(fields: [quoteId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([quoteId])
  @@index([productId])
}

// ê¸°ì¡´ QuoteItem ëª¨ë¸ (í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€)
model QuoteItem {
  id        String   @id @default(cuid())
  quoteId   String
  productId String
  quantity  Int      @default(1)
  notes     String?  @db.Text
  createdAt DateTime @default(now())

  // ê´€ê³„
  quote Quote @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@index([quoteId])
  @@index([productId])
}

// QuoteStatus enumì€ ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€ (í–¥í›„ ì œê±° ê°€ëŠ¥)
enum QuoteStatus {
  PENDING // ëŒ€ê¸° ì¤‘
  SENT // ë°œì†¡ ì™„ë£Œ
  RESPONDED // ì‘ë‹µ ë°›ìŒ
  COMPLETED // ì™„ë£Œ
  CANCELLED // ì·¨ì†Œ
}

// ê²¬ì  ì‘ë‹µ
model QuoteResponse {
  id         String    @id @default(cuid())
  quoteId    String
  vendorId   String
  totalPrice Float?
  currency   String    @default("KRW")
  message    String?   @db.Text
  validUntil DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  // ê´€ê³„
  quote  Quote  @relation(fields: [quoteId], references: [id], onDelete: Cascade)
  vendor Vendor @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@index([quoteId])
  @@index([vendorId])
}

// ë²¤ë” ê³¼ê¸ˆ ê¸°ë¡
model VendorBillingRecord {
  id          String    @id @default(cuid())
  vendorId    String
  type        String // "LEAD", "PREMIUM", "REPORT"
  amount      Float // ê³¼ê¸ˆ ê¸ˆì•¡
  quantity    Int? // ë¦¬ë“œ ìˆ˜, ë¦¬í¬íŠ¸ ìˆ˜ ë“±
  description String?   @db.Text
  periodStart DateTime? // ê³¼ê¸ˆ ê¸°ê°„ ì‹œì‘
  periodEnd   DateTime? // ê³¼ê¸ˆ ê¸°ê°„ ì¢…ë£Œ
  createdAt   DateTime  @default(now())

  // ê´€ê³„
  vendor Vendor @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@index([vendorId])
  @@index([createdAt])
}

// ì¦ê²¨ì°¾ê¸°
model Favorite {
  id        String   @id @default(cuid())
  userId    String
  productId String
  createdAt DateTime @default(now())

  // ê´€ê³„
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId])
}

// ê²€ìƒ‰ ê¸°ë¡
model SearchHistory {
  id               String           @id @default(cuid())
  userId           String?
  query            String
  intent           Json? // GPT ë¶„ë¥˜ ê²°ê³¼
  category         ProductCategory?
  filters          Json? // ì ìš©ëœ í•„í„°
  resultCount      Int?
  clickedProductId String?
  createdAt        DateTime         @default(now())

  // ê´€ê³„
  user    User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product? @relation(fields: [clickedProductId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([createdAt])
}

// ì œí’ˆ ì¶”ì²œ (AI ì¶”ì²œ ê²°ê³¼ ì €ì¥)
model ProductRecommendation {
  id                   String   @id @default(cuid())
  productId            String
  recommendedProductId String
  score                Float // ìœ ì‚¬ë„ ì ìˆ˜
  reason               String?  @db.Text // ì¶”ì²œ ê·¼ê±°
  reasonEn             String?  @db.Text
  createdAt            DateTime @default(now())

  // ê´€ê³„
  product     Product                  @relation("ProductRecommendations", fields: [productId], references: [id], onDelete: Cascade)
  recommended Product                  @relation("RecommendedProducts", fields: [recommendedProductId], references: [id], onDelete: Cascade)
  feedbacks   RecommendationFeedback[]

  @@unique([productId, recommendedProductId])
  @@index([productId])
  @@index([score])
}

// ì¶”ì²œ í’ˆì§ˆ í”¼ë“œë°±
model RecommendationFeedback {
  id               String   @id @default(cuid())
  userId           String?
  recommendationId String
  isHelpful        Boolean // ğŸ‘/ğŸ‘
  reason           String?  @db.Text // ë„ì›€ì´ ëœ ì´ìœ /ì´ìœ  ì—†ìŒ
  createdAt        DateTime @default(now())

  // ê´€ê³„
  recommendation ProductRecommendation @relation(fields: [recommendationId], references: [id], onDelete: Cascade)

  @@index([recommendationId])
  @@index([userId])
}

// ì œí’ˆ ë¦¬ë·° ë° í‰ì 
model Review {
  id        String   @id @default(cuid())
  userId    String
  productId String
  rating    Int // 1-5ì 
  title     String?
  comment   String?  @db.Text
  pros      String?  @db.Text // ì¥ì 
  cons      String?  @db.Text // ë‹¨ì 
  verified  Boolean  @default(false) // êµ¬ë§¤ ì¸ì¦ ì—¬ë¶€
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ê´€ê³„
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId]) // ì‚¬ìš©ìë‹¹ ì œí’ˆë‹¹ í•˜ë‚˜ì˜ ë¦¬ë·°ë§Œ
  @@index([productId])
  @@index([userId])
  @@index([rating])
  @@index([createdAt])
}

// ì œí’ˆ ì¬ê³  ê´€ë¦¬
model ProductInventory {
  id                   String    @id @default(cuid())
  userId               String? // ì‚¬ìš©ìë³„ ì¬ê³ 
  organizationId       String? // ì¡°ì§ë³„ ì¬ê³ 
  productId            String
  currentQuantity      Float     @default(0) // í˜„ì¬ ì¬ê³ ëŸ‰
  unit                 String?   @default("ê°œ") // ë‹¨ìœ„ (ê°œ, mL, g ë“±)
  safetyStock          Float? // ì•ˆì „ ì¬ê³  (ì´ ìˆ˜ëŸ‰ ì´í•˜ë¡œ ë–¨ì–´ì§€ë©´ ì¬ì£¼ë¬¸ ì¶”ì²œ)
  minOrderQty          Float? // ìµœì†Œ ì£¼ë¬¸ ìˆ˜ëŸ‰
  location             String? // ë³´ê´€ ìœ„ì¹˜
  expiryDate           DateTime? // ìœ í†µê¸°í•œ
  autoReorderEnabled   Boolean   @default(false) // ìë™ ì¬ì£¼ë¬¸ í™œì„±í™” ì—¬ë¶€
  autoReorderThreshold Float? // ìë™ ì¬ì£¼ë¬¸ ì„ê³„ê°’ (ê¸°ë³¸ê°’: safetyStock)
  notes                String?   @db.Text
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  // ê´€ê³„
  user         User?            @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization Organization?    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product      Product          @relation(fields: [productId], references: [id], onDelete: Cascade)
  usageRecords InventoryUsage[]

  @@unique([userId, productId]) // ì‚¬ìš©ìë³„ ì œí’ˆë‹¹ í•˜ë‚˜ì˜ ì¬ê³  ê¸°ë¡
  @@unique([organizationId, productId]) // ì¡°ì§ë³„ ì œí’ˆë‹¹ í•˜ë‚˜ì˜ ì¬ê³  ê¸°ë¡
  @@index([productId])
  @@index([userId])
  @@index([organizationId])
  @@index([currentQuantity])
}

// ì¬ê³  ì‚¬ìš©ëŸ‰ ê¸°ë¡ (ì‚¬ìš©ëŸ‰ ì¶”ì •ì„ ìœ„í•œ ë°ì´í„°)
model InventoryUsage {
  id          String   @id @default(cuid())
  inventoryId String
  userId      String
  quantity    Float // ì‚¬ìš©ëŸ‰
  unit        String? // ë‹¨ìœ„
  usageDate   DateTime @default(now()) // ì‚¬ìš© ì¼ì
  notes       String?  @db.Text
  createdAt   DateTime @default(now())

  // ê´€ê³„
  inventory ProductInventory @relation(fields: [inventoryId], references: [id], onDelete: Cascade)
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([inventoryId])
  @@index([userId])
  @@index([usageDate])
}

// ê³µìœ  ë§í¬ (ìŠ¤ëƒ…ìƒ· ë°©ì‹)
model SharedList {
  id          String    @id @default(cuid())
  quoteId     String // ì›ë³¸ QuoteList ID
  publicId    String    @unique // ê³µìœ ìš© ë‚œìˆ˜ í† í°
  title       String
  description String?   @db.Text
  snapshot    Json // ìŠ¤ëƒ…ìƒ· ë°ì´í„° (í’ˆëª© ë¦¬ìŠ¤íŠ¸ ì „ì²´)
  createdBy   String? // ì‘ì„±ì ID (ì˜µì…˜)
  expiresAt   DateTime? // ë§Œë£Œì¼ (P1)
  isActive    Boolean   @default(true) // ë¹„í™œì„±í™” ì—¬ë¶€
  viewCount   Int       @default(0) // ì¡°íšŒ ìˆ˜
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // ê´€ê³„
  quote Quote @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@index([publicId])
  @@index([quoteId])
  @@index([isActive])
}

// ì‹¤ì œ êµ¬ë§¤ë‚´ì—­ (CSV Importìš©)
model PurchaseRecord {
  id             String   @id @default(cuid())
  quoteId        String? // BioInsight Labì—ì„œ ìƒì„±í•œ ë¦¬ìŠ¤íŠ¸ì™€ ì—°ê²°
  organizationId String? // ì¡°ì§/íŒ€
  projectName    String? // í”„ë¡œì íŠ¸/ê³¼ì œëª…
  vendorId       String? // ë²¤ë”
  productId      String? // ì œí’ˆ
  externalDocId  String? // ì™¸ë¶€ ë¬¸ì„œ ë²ˆí˜¸ (ê·¸ë£¹ì›¨ì–´/ERP)
  purchaseDate   DateTime // êµ¬ë§¤ì¼
  quantity       Int
  unitPrice      Float
  currency       String   @default("KRW")
  totalAmount    Float // ì´ì•¡ (ì„¸ê¸ˆ, ë°°ì†¡ë¹„ í¬í•¨ ì—¬ë¶€ëŠ” notesì—)
  category       String? // ì¹´í…Œê³ ë¦¬
  notes          String?  @db.Text // ë¹„ê³  (ì„¸ê¸ˆ í¬í•¨ ì—¬ë¶€, ë°°ì†¡ë¹„ ë“±)
  importedAt     DateTime @default(now()) // Import ì‹œì 
  importedBy     String? // Importí•œ ì‚¬ìš©ì
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // ê´€ê³„
  quote        Quote?        @relation(fields: [quoteId], references: [id], onDelete: SetNull)
  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: SetNull)
  vendor       Vendor?       @relation(fields: [vendorId], references: [id], onDelete: SetNull)
  product      Product?      @relation(fields: [productId], references: [id], onDelete: SetNull)

  @@index([quoteId])
  @@index([organizationId])
  @@index([vendorId])
  @@index([productId])
  @@index([purchaseDate])
  @@index([category])
}

// ì˜ˆì‚° ê´€ë¦¬ (P2)
model Budget {
  id             String   @id @default(cuid())
  organizationId String? // ì¡°ì§/íŒ€
  projectName    String? // í”„ë¡œì íŠ¸/ê³¼ì œëª…
  name           String // ì˜ˆì‚° ì´ë¦„
  amount         Float // ì˜ˆì‚° ê¸ˆì•¡
  currency       String   @default("KRW")
  periodStart    DateTime // ì˜ˆì‚° ê¸°ê°„ ì‹œì‘
  periodEnd      DateTime // ì˜ˆì‚° ê¸°ê°„ ì¢…ë£Œ
  description    String?  @db.Text
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // ê´€ê³„
  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: SetNull)

  @@index([organizationId])
  @@index([periodStart, periodEnd])
}

// êµ¬ë… ì •ë³´ (Team/Org í”Œëœ)
model Subscription {
  id                 String           @id @default(cuid())
  organizationId     String           @unique
  plan               SubscriptionPlan @default(FREE)
  status             String           @default("active") // active, cancelled, expired
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  cancelAtPeriodEnd  Boolean          @default(false)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt

  // ê´€ê³„
  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([status])
}
