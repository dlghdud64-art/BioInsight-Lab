// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ?¬ìš©??ë°?ê¶Œí•œ
enum UserRole {
  RESEARCHER // ?°êµ¬??
  BUYER // êµ¬ë§¤ ?´ë‹¹??
  SUPPLIER // ê³µê¸‰??
  ADMIN // ê´€ë¦¬ì
}

// ì¡°ì§ ????•  (?Œí¬?¤í˜?´ìŠ¤ ??• )
enum OrganizationRole {
  VIEWER // ì¡°íšŒë§?ê°€??
  REQUESTER // ê²¬ì  ?”ì²­ ê°€??
  APPROVER // ê²¬ì  ?¹ì¸ ê°€??
  ADMIN // ì¡°ì§ ê´€ë¦¬ì
}

// êµ¬ë… ?Œëœ ?€??
enum SubscriptionPlan {
  FREE // ë¬´ë£Œ/Beta
  TEAM // ?€ ?Œëœ
  ORGANIZATION // ì¡°ì§/Enterprise ?Œëœ
}

// ì¡°ì§/?Œí¬?¤í˜?´ìŠ¤
model Organization {
  id                String           @id @default(cuid())
  name              String
  description       String?          @db.Text
  plan              SubscriptionPlan @default(FREE) // êµ¬ë… ?Œëœ
  planExpiresAt     DateTime? // ?Œëœ ë§Œë£Œ??
  maxMembers        Int? // ìµœë? ë©¤ë²„ ??(?Œëœë³??œí•œ)
  maxQuotesPerMonth Int? // ?”ë³„ ìµœë? ?ˆëª© ë¦¬ìŠ¤????
  maxSharedLinks    Int? // ìµœë? ê³µìœ  ë§í¬ ??
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  // ê´€ê³?
  members         OrganizationMember[]
  quotes          Quote[]
  templates       QuoteTemplate[]
  inventories     ProductInventory[]
  purchaseRecords PurchaseRecord[]
  budgets         Budget[]
  subscription    Subscription? // êµ¬ë… ?•ë³´

  @@index([name])
  @@index([plan])
}

// ì¡°ì§ ë©¤ë²„
model OrganizationMember {
  id             String           @id @default(cuid())
  userId         String
  organizationId String
  role           OrganizationRole @default(VIEWER)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  // ê´€ê³?
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([userId, organizationId])
  @@index([userId])
  @@index([organizationId])
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  emailVerified DateTime?
  name          String?
  image         String?
  role          UserRole  @default(RESEARCHER)
  organization  String? // ?ˆê±°???„ë“œ (ì¡°ì§ëª?ì§ì ‘ ?…ë ¥)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // NextAuth ê´€ê³?
  accounts Account[]
  sessions Session[]

  // ê´€ê³?
  quotes              Quote[]
  comparisons         Comparison[]
  favorites           Favorite[]
  searchHistory       SearchHistory[]
  organizationMembers OrganizationMember[]
  reviews             Review[]
  templates           QuoteTemplate[]
  inventories         ProductInventory[]
  inventoryUsage      InventoryUsage[]

  @@index([email])
  @@index([role])
}

// NextAuth.js v5ë¥??„í•œ ëª¨ë¸
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

// ?œí’ˆ ì¹´í…Œê³ ë¦¬
enum ProductCategory {
  REAGENT // ?œì•½
  TOOL // ê¸°êµ¬
  EQUIPMENT // ?¥ë¹„
}

// ?œí’ˆ
model Product {
  id                    String                       @id @default(cuid())
  name                  String
  nameEn                String? // ?ë¬¸ëª?
  description           String?                      @db.Text
  descriptionEn         String?                      @db.Text
  descriptionTranslated String?                      @db.Text // ë²ˆì—­???¤ëª… (GPT ë²ˆì—­)
  category              ProductCategory
  brand                 String?
  modelNumber           String?
  catalogNumber         String? // ì¹´íƒˆë¡œê·¸ ë²ˆí˜¸
  specifications        Json? // ?¤í™ ?•ë³´ (JSON)
  datasheetUrl          String?
  imageUrl              String?
  embedding             Unsupported("vector(1536)")? // ë²¡í„° ?„ë² ??(pgvector)
  // ê·¸ë£¹?¨ì–´ ì¹œí™”???„ë“œ
  grade                 String? // Grade (HPLC grade, GMP, EP/USP, cell culture tested ??
  specification         String? // ê·œê²©/?©ëŸ‰ (?? 1mg, 500mL, 0.22um ??
  regulatoryCompliance  String? // ê·œì œ/?½ì „ ê·œê²© (USP, EP, JP ??

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ê´€ê³?
  vendors         ProductVendor[]
  comparisons     ComparisonProduct[]
  favorites       Favorite[]
  recommendations ProductRecommendation[] @relation("ProductRecommendations")
  recommendedFor  ProductRecommendation[] @relation("RecommendedProducts")
  searchHistory   SearchHistory[]
  reviews         Review[]
  quoteListItems  QuoteListItem[]
  inventories     ProductInventory[]
  purchaseRecords PurchaseRecord[]

  @@index([category])
  @@index([brand])
  @@index([name])
}

// ë²¤ë”/ê³µê¸‰??
model Vendor {
  id                String    @id @default(cuid())
  name              String
  nameEn            String?
  email             String?
  phone             String?
  website           String?
  country           String?   @default("KR")
  currency          String?   @default("KRW")
  // ?˜ìµ ëª¨ë¸ ê´€???„ë“œ
  isPremium         Boolean   @default(false) // ?„ë¦¬ë¯¸ì—„ ?Œëœ ?¬ë?
  premiumExpiresAt  DateTime? // ?„ë¦¬ë¯¸ì—„ ë§Œë£Œ??
  leadPricePerQuote Float?    @default(0) // ë¦¬ë“œ??ê³¼ê¸ˆ (ê²¬ì  ?”ì²­??
  totalLeads        Int       @default(0) // ì´?ë¦¬ë“œ ??
  totalRevenue      Float     @default(0) // ì´??˜ìµ
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // ê´€ê³?
  products        ProductVendor[]
  quoteResponses  QuoteResponse[]
  billingRecords  VendorBillingRecord[]
  purchaseRecords PurchaseRecord[]

  @@index([name])
  @@index([isPremium])
}

// ?œí’ˆ-ë²¤ë” ê´€ê³?(ê°€ê²? ?¬ê³ , ?©ê¸° ?•ë³´)
model ProductVendor {
  id                String   @id @default(cuid())
  productId         String
  vendorId          String
  price             Float?
  currency          String   @default("KRW")
  priceInKRW        Float? // KRW ?˜ì‚° ê°€ê²?
  stockStatus       String? // ?¬ê³  ?íƒœ
  leadTime          Int? // ?©ê¸°??(???¨ìœ„)
  minOrderQty       Int?
  url               String?
  // ?„ë¦¬ë¯¸ì—„ ?¸ì¶œ ê´€??
  isPremiumFeatured Boolean  @default(false) // ?„ë¦¬ë¯¸ì—„ ì¶”ì²œ ?ì—­ ?¸ì¶œ
  premiumPriority   Int      @default(0) // ?„ë¦¬ë¯¸ì—„ ?°ì„ ?œìœ„ (?’ì„?˜ë¡ ?ë‹¨ ?¸ì¶œ)
  lastUpdated       DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // ê´€ê³?
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  vendor  Vendor  @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@unique([productId, vendorId])
  @@index([productId])
  @@index([vendorId])
  @@index([priceInKRW])
  @@index([isPremiumFeatured, premiumPriority])
}

// ë¹„êµ ?Œì´ë¸?
model Comparison {
  id        String   @id @default(cuid())
  userId    String
  name      String? // ë¹„êµ ?¸íŠ¸ ?´ë¦„
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ê´€ê³?
  user     User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  products ComparisonProduct[]

  @@index([userId])
}

// ë¹„êµ-?œí’ˆ ê´€ê³?
model ComparisonProduct {
  id           String   @id @default(cuid())
  comparisonId String
  productId    String
  order        Int // ?•ë ¬ ?œì„œ
  createdAt    DateTime @default(now())

  // ê´€ê³?
  comparison Comparison @relation(fields: [comparisonId], references: [id], onDelete: Cascade)
  product    Product    @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([comparisonId, productId])
  @@index([comparisonId])
}

// ê·¸ë£¹?¨ì–´???ˆëª© ë¦¬ìŠ¤??(ê¸°ì¡´ Quote ëª¨ë¸ ? ì??˜ë˜, ê°œë…???ˆëª© ë¦¬ìŠ¤?¸ë¡œ ?•ì¥)
model Quote {
  id             String    @id @default(cuid())
  userId         String
  organizationId String? // ì¡°ì§ ?¨ìœ„ ë¦¬ìŠ¤?¸ì¸ ê²½ìš°
  comparisonId   String? // ë¹„êµ ?¸íŠ¸ ê¸°ë°˜ ë¦¬ìŠ¤?¸ì¸ ê²½ìš°
  title          String // ë¦¬ìŠ¤???œëª©
  description    String?   @db.Text // ë¦¬ìŠ¤???¤ëª…/ë¹„ê³ 
  // ê·¸ë£¹?¨ì–´ ?°ë™ ?•ë³´
  templateId     String? // ?¬ìš©???œí”Œë¦?ID
  templateType   String? // ?œí”Œë¦??€??(R&D, QC, ?ì‚° ?? - ?˜ìœ„ ?¸í™˜??
  exportedAt     DateTime? // ?´ë³´?´ê¸° ?œì 
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // ê´€ê³?
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization    Organization?    @relation(fields: [organizationId], references: [id], onDelete: SetNull)
  template        QuoteTemplate?   @relation(fields: [templateId], references: [id], onDelete: SetNull)
  items           QuoteListItem[] // QuoteItem ?€??QuoteListItem ?¬ìš©
  quoteItems      QuoteItem[] // ?ˆê±°???¸í™˜??
  // ê¸°ì¡´ ?¸í™˜?±ì„ ?„í•´ QuoteResponse ? ì? (?¥í›„ ?œê±° ê°€??
  responses       QuoteResponse[]
  sharedLists     SharedList[] // ê³µìœ  ë§í¬
  purchaseRecords PurchaseRecord[] // ?¤ì œ êµ¬ë§¤?´ì—­

  @@index([userId])
  @@index([organizationId])
  @@index([templateId])
}

// ?ˆëª© ë¦¬ìŠ¤???œí”Œë¦?(ì¡°ì§ë³??©ë„ë³?ì»¬ëŸ¼ ?¸íŠ¸)
model QuoteTemplate {
  id             String   @id @default(cuid())
  name           String // ?œí”Œë¦??´ë¦„ (?? "R&D ê¸°ë³¸??, "QC ?œí—˜??, "?ì‚° ?€?‰êµ¬ë§¤í˜•")
  type           String // ?œí”Œë¦??€??(R&D, QC, PRODUCTION, CUSTOM)
  organizationId String? // ì¡°ì§ë³??œí”Œë¦¿ì¸ ê²½ìš°
  userId         String? // ?¬ìš©?ë³„ ì»¤ìŠ¤?€ ?œí”Œë¦¿ì¸ ê²½ìš°
  description    String?  @db.Text
  // ì»¬ëŸ¼ ?¤ì • (JSON)
  columns        Json // ?œì‹œ??ì»¬ëŸ¼ê³??œì„œ, ?„ìˆ˜/? íƒ ?¬ë? ??
  // ?? { columns: [{ key: "lineNumber", label: "Line No.", required: true, order: 1 }, ...] }
  isDefault      Boolean  @default(false) // ê¸°ë³¸ ?œí”Œë¦??¬ë?
  isPublic       Boolean  @default(false) // ê³µê°œ ?œí”Œë¦??¬ë? (?¤ë¥¸ ?¬ìš©?ë„ ?¬ìš© ê°€??
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // ê´€ê³?
  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user         User?         @relation(fields: [userId], references: [id], onDelete: Cascade)
  quotes       Quote[]

  @@index([organizationId])
  @@index([userId])
  @@index([type])
}

// ê·¸ë£¹?¨ì–´???ˆëª© ë¦¬ìŠ¤????ª© (ê¸°ì¡´ QuoteItem???•ì¥)
model QuoteListItem {
  id         String   @id @default(cuid())
  quoteId    String
  productId  String
  lineNumber Int // Line No. (ê·¸ë£¹?¨ì–´??
  quantity   Int      @default(1)
  unitPrice  Float? // ?¨ê?
  currency   String?  @default("KRW")
  lineTotal  Float? // ê¸ˆì•¡ (?¨ê? Ã— ?˜ëŸ‰)
  notes      String?  @db.Text // ë¹„ê³  (?©ë„/?€ì²´í’ˆ ?¬ë?/ê¸°ì¡´ ?œí’ˆ ì½”ë“œ ??
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // ê´€ê³?
  quote   Quote   @relation(fields: [quoteId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([quoteId])
  @@index([productId])
}

// ê¸°ì¡´ QuoteItem ëª¨ë¸ (?˜ìœ„ ?¸í™˜??? ì?)
model QuoteItem {
  id        String   @id @default(cuid())
  quoteId   String
  productId String
  quantity  Int      @default(1)
  notes     String?  @db.Text
  createdAt DateTime @default(now())

  // ê´€ê³?
  quote Quote @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@index([quoteId])
  @@index([productId])
}

// QuoteStatus enum?€ ê¸°ì¡´ ?¸í™˜?±ì„ ?„í•´ ? ì? (?¥í›„ ?œê±° ê°€??
enum QuoteStatus {
  PENDING // ?€ê¸?ì¤?
  SENT // ë°œì†¡ ?„ë£Œ
  RESPONDED // ?‘ë‹µ ë°›ìŒ
  COMPLETED // ?„ë£Œ
  CANCELLED // ì·¨ì†Œ
}

// ê²¬ì  ?‘ë‹µ
model QuoteResponse {
  id         String    @id @default(cuid())
  quoteId    String
  vendorId   String
  totalPrice Float?
  currency   String    @default("KRW")
  message    String?   @db.Text
  validUntil DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  // ê´€ê³?
  quote  Quote  @relation(fields: [quoteId], references: [id], onDelete: Cascade)
  vendor Vendor @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@index([quoteId])
  @@index([vendorId])
}

// ë²¤ë” ê³¼ê¸ˆ ê¸°ë¡
model VendorBillingRecord {
  id          String    @id @default(cuid())
  vendorId    String
  type        String // "LEAD", "PREMIUM", "REPORT"
  amount      Float // ê³¼ê¸ˆ ê¸ˆì•¡
  quantity    Int? // ë¦¬ë“œ ?? ë¦¬í¬??????
  description String?   @db.Text
  periodStart DateTime? // ê³¼ê¸ˆ ê¸°ê°„ ?œì‘
  periodEnd   DateTime? // ê³¼ê¸ˆ ê¸°ê°„ ì¢…ë£Œ
  createdAt   DateTime  @default(now())

  // ê´€ê³?
  vendor Vendor @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@index([vendorId])
  @@index([createdAt])
}

// ì¦ê²¨ì°¾ê¸°
model Favorite {
  id        String   @id @default(cuid())
  userId    String
  productId String
  createdAt DateTime @default(now())

  // ê´€ê³?
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId])
}

// ê²€??ê¸°ë¡
model SearchHistory {
  id               String           @id @default(cuid())
  userId           String?
  query            String
  intent           Json? // GPT ë¶„ë¥˜ ê²°ê³¼
  category         ProductCategory?
  filters          Json? // ?ìš©???„í„°
  resultCount      Int?
  clickedProductId String?
  createdAt        DateTime         @default(now())

  // ê´€ê³?
  user    User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product? @relation(fields: [clickedProductId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([createdAt])
}

// ?œí’ˆ ì¶”ì²œ (AI ì¶”ì²œ ê²°ê³¼ ?€??
model ProductRecommendation {
  id                   String   @id @default(cuid())
  productId            String
  recommendedProductId String
  score                Float // ? ì‚¬???ìˆ˜
  reason               String?  @db.Text // ì¶”ì²œ ê·¼ê±°
  reasonEn             String?  @db.Text
  createdAt            DateTime @default(now())

  // ê´€ê³?
  product     Product                  @relation("ProductRecommendations", fields: [productId], references: [id], onDelete: Cascade)
  recommended Product                  @relation("RecommendedProducts", fields: [recommendedProductId], references: [id], onDelete: Cascade)
  feedbacks   RecommendationFeedback[]

  @@unique([productId, recommendedProductId])
  @@index([productId])
  @@index([score])
}

// ì¶”ì²œ ?ˆì§ˆ ?¼ë“œë°?
model RecommendationFeedback {
  id               String   @id @default(cuid())
  userId           String?
  recommendationId String
  isHelpful        Boolean // ?‘/?‘
  reason           String?  @db.Text // ?„ì??????´ìœ /?´ìœ  ?†ìŒ
  createdAt        DateTime @default(now())

  // ê´€ê³?
  recommendation ProductRecommendation @relation(fields: [recommendationId], references: [id], onDelete: Cascade)

  @@index([recommendationId])
  @@index([userId])
}

// ?œí’ˆ ë¦¬ë·° ë°??‰ì 
model Review {
  id        String   @id @default(cuid())
  userId    String
  productId String
  rating    Int // 1-5??
  title     String?
  comment   String?  @db.Text
  pros      String?  @db.Text // ?¥ì 
  cons      String?  @db.Text // ?¨ì 
  verified  Boolean  @default(false) // êµ¬ë§¤ ?¸ì¦ ?¬ë?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ê´€ê³?
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId]) // ?¬ìš©?ë‹¹ ?œí’ˆ???˜ë‚˜??ë¦¬ë·°ë§?
  @@index([productId])
  @@index([userId])
  @@index([rating])
  @@index([createdAt])
}

// ?œí’ˆ ?¬ê³  ê´€ë¦?
model ProductInventory {
  id                   String    @id @default(cuid())
  userId               String? // ?¬ìš©?ë³„ ?¬ê³ 
  organizationId       String? // ì¡°ì§ë³??¬ê³ 
  productId            String
  currentQuantity      Float     @default(0) // ?„ì¬ ?¬ê³ ??
  unit                 String?   @default("ea") // ´ÜÀ§ (¿¹: mL, g µî)
  safetyStock          Float? // ?ˆì „ ?¬ê³  (???˜ëŸ‰ ?´í•˜ë¡??¨ì–´ì§€ë©??¬ì£¼ë¬?ì¶”ì²œ)
  minOrderQty          Float? // ìµœì†Œ ì£¼ë¬¸ ?˜ëŸ‰
  location             String? // ë³´ê? ?„ì¹˜
  expiryDate           DateTime? // ? í†µê¸°í•œ
  autoReorderEnabled   Boolean   @default(false) // ?ë™ ?¬ì£¼ë¬??œì„±???¬ë?
  autoReorderThreshold Float? // ?ë™ ?¬ì£¼ë¬??„ê³„ê°?(ê¸°ë³¸ê°? safetyStock)
  notes                String?   @db.Text
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  // ê´€ê³?
  user         User?            @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization Organization?    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  product      Product          @relation(fields: [productId], references: [id], onDelete: Cascade)
  usageRecords InventoryUsage[]

  @@unique([userId, productId]) // ?¬ìš©?ë³„ ?œí’ˆ???˜ë‚˜???¬ê³  ê¸°ë¡
  @@unique([organizationId, productId]) // ì¡°ì§ë³??œí’ˆ???˜ë‚˜???¬ê³  ê¸°ë¡
  @@index([productId])
  @@index([userId])
  @@index([organizationId])
  @@index([currentQuantity])
}

// ?¬ê³  ?¬ìš©??ê¸°ë¡ (?¬ìš©??ì¶”ì •???„í•œ ?°ì´??
model InventoryUsage {
  id          String   @id @default(cuid())
  inventoryId String
  userId      String
  quantity    Float // ?¬ìš©??
  unit        String? // ?¨ìœ„
  usageDate   DateTime @default(now()) // ?¬ìš© ?¼ì
  notes       String?  @db.Text
  createdAt   DateTime @default(now())

  // ê´€ê³?
  inventory ProductInventory @relation(fields: [inventoryId], references: [id], onDelete: Cascade)
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([inventoryId])
  @@index([userId])
  @@index([usageDate])
}

// ê³µìœ  ë§í¬ (?¤ëƒ…??ë°©ì‹)
model SharedList {
  id          String    @id @default(cuid())
  quoteId     String // ?ë³¸ QuoteList ID
  publicId    String    @unique // ê³µìœ ???œìˆ˜ ? í°
  title       String
  description String?   @db.Text
  snapshot    Json // ?¤ëƒ…???°ì´??(?ˆëª© ë¦¬ìŠ¤???„ì²´)
  createdBy   String? // ?‘ì„±??ID (?µì…˜)
  expiresAt   DateTime? // ë§Œë£Œ??(P1)
  isActive    Boolean   @default(true) // ë¹„í™œ?±í™” ?¬ë?
  viewCount   Int       @default(0) // ì¡°íšŒ ??
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // ê´€ê³?
  quote Quote @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@index([publicId])
  @@index([quoteId])
  @@index([isActive])
}

// ?¤ì œ êµ¬ë§¤?´ì—­ (CSV Import??
model PurchaseRecord {
  id             String   @id @default(cuid())
  quoteId        String? // BioInsight Lab?ì„œ ?ì„±??ë¦¬ìŠ¤?¸ì? ?°ê²°
  organizationId String? // ì¡°ì§/?€
  projectName    String? // ?„ë¡œ?íŠ¸/ê³¼ì œëª?
  vendorId       String? // ë²¤ë”
  productId      String? // ?œí’ˆ
  externalDocId  String? // ?¸ë? ë¬¸ì„œ ë²ˆí˜¸ (ê·¸ë£¹?¨ì–´/ERP)
  purchaseDate   DateTime // êµ¬ë§¤??
  quantity       Int
  unitPrice      Float
  currency       String   @default("KRW")
  totalAmount    Float // ì´ì•¡ (?¸ê¸ˆ, ë°°ì†¡ë¹??¬í•¨ ?¬ë???notes??
  category       String? // ì¹´í…Œê³ ë¦¬
  notes          String?  @db.Text // ë¹„ê³  (?¸ê¸ˆ ?¬í•¨ ?¬ë?, ë°°ì†¡ë¹???
  importedAt     DateTime @default(now()) // Import ?œì 
  importedBy     String? // Import???¬ìš©??
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // ê´€ê³?
  quote        Quote?        @relation(fields: [quoteId], references: [id], onDelete: SetNull)
  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: SetNull)
  vendor       Vendor?       @relation(fields: [vendorId], references: [id], onDelete: SetNull)
  product      Product?      @relation(fields: [productId], references: [id], onDelete: SetNull)

  @@index([quoteId])
  @@index([organizationId])
  @@index([vendorId])
  @@index([productId])
  @@index([purchaseDate])
  @@index([category])
}

// ?ˆì‚° ê´€ë¦?(P2)
model Budget {
  id             String   @id @default(cuid())
  organizationId String? // ì¡°ì§/?€
  projectName    String? // ?„ë¡œ?íŠ¸/ê³¼ì œëª?
  name           String // ?ˆì‚° ?´ë¦„
  amount         Float // ?ˆì‚° ê¸ˆì•¡
  currency       String   @default("KRW")
  periodStart    DateTime // ?ˆì‚° ê¸°ê°„ ?œì‘
  periodEnd      DateTime // ?ˆì‚° ê¸°ê°„ ì¢…ë£Œ
  description    String?  @db.Text
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // ê´€ê³?
  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: SetNull)

  @@index([organizationId])
  @@index([periodStart, periodEnd])
}

// êµ¬ë… ?•ë³´ (Team/Org ?Œëœ)
model Subscription {
  id                 String           @id @default(cuid())
  organizationId     String           @unique
  plan               SubscriptionPlan @default(FREE)
  status             String           @default("active") // active, cancelled, expired
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  cancelAtPeriodEnd  Boolean          @default(false)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt

  // ê´€ê³?
  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([status])
}
